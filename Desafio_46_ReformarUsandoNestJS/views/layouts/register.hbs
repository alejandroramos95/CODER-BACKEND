<html lang='en'>
    <head>
        <meta charset='UTF-8' />
        <meta http-equiv='X-UA-Compatible' content='IE=edge' />
        <meta name='viewport' content='width=device-width, initial-scale=1.0' />
        <!-- Font Awesome -->
        <link
            href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css'
            rel='stylesheet'
        />
        <!-- Google Fonts -->
        <link
            href='https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap'
            rel='stylesheet'
        />
        <!-- MDB -->
        <link
            href='https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.1.0/mdb.min.css'
            rel='stylesheet'
        />
        <!-- MDB -->
        <script
            type='text/javascript'
            src='https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.1.0/mdb.min.js'
        ></script>
        <title>Registration</title>
    </head>
    <body>
        <section
            class='vh-100 bg-image'
            style="background-image: url('https://mdbcdn.b-cdn.net/img/Photos/new-templates/search-box/img4.webp');"
        >
            <div class='mask d-flex align-items-center h-100 gradient-custom-3'>
                <div class='container h-100'>
                    <div
                        class='row d-flex justify-content-center align-items-center h-100'
                    >
                        <div class='col-12 col-md-9 col-lg-7 col-xl-6'>
                            <div class='card' style='border-radius: 15px;'>
                                <div class='card-body p-5'>
                                    <h2
                                        class='text-uppercase text-center mb-5'
                                    >Crea una Cuenta</h2>

                                    <form id="myForm">

                                        <div class='form-outline mb-4'>
                                            <input
                                                type='text'
                                                id='username'
                                                class='form-control form-control-lg'
                                                name="name"
                                                required
                                            />
                                            <label
                                                class='form-label'
                                                for='username'
                                            >Nombre</label>
                                        </div>

                                        <div class='form-outline mb-4'>
                                            <input
                                                type='email'
                                                id='email'
                                                class='form-control form-control-lg'
                                                name="email"
                                                required
                                            />
                                            <label
                                                class='form-label'
                                                for='email'
                                            >Email</label>
                                        </div>

                                        <div class='form-outline mb-4'>
                                            <input
                                                type='password'
                                                id='password'
                                                class='form-control form-control-lg'
                                                name="password"
                                                required
                                            />
                                            <label
                                                class='form-label'
                                                for='password'
                                            >Contraseña</label>
                                        </div>

                                        <div class='form-outline mb-4'>
                                            <input
                                                type='password'
                                                id='confirmPassword'
                                                class='form-control form-control-lg'
                                                required
                                            />
                                            <label
                                                class='form-label'
                                                for='confirmPassword'
                                            >Confirmar Contraseña</label>
                                        </div>

                                        <div class='form-outline mb-4'>
                                            <input
                                                type='text'
                                                id='address'
                                                class='form-control form-control-lg'
                                                name="address"
                                                required
                                            />
                                            <label
                                                class='form-label'
                                                for='address'
                                            >Dirección</label>
                                        </div>

                                        <div class='form-outline mb-4'>
                                            <input
                                                type='number'
                                                min="10"
                                                max="80"
                                                id='age'
                                                class='form-control form-control-lg'
                                                name="age"
                                                required
                                            />
                                            <label
                                                class='form-label'
                                                for='age'
                                            >Edad</label>
                                        </div>

                                        <div class='form-outline mb-4'>
                                            <input
                                                type='text'
                                                id='avatar'
                                                class='form-control form-control-lg'
                                                name="avatar"
                                            />
                                            <label
                                                class='form-label'
                                                for='avatar'
                                            >Foto de perfil</label>
                                        </div>

                                        <div
                                            class='d-flex justify-content-center'
                                        >
                                            <button
                                                type='button'
                                                class='btn btn-success btn-block btn-lg gradient-custom-4 text-body'
                                                onclick="validateForm()"
                                            >Registrarse</button>
                                        </div>

                                        <p
                                            class='text-center text-muted mt-5 mb-0'
                                        >¿Ya tienes cuenta?
                                            <a
                                                href='/login'
                                                class='fw-bold text-body'
                                            ><u>Inicia sesión aquí</u></a></p>

                                    </form>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <script>
            async function validateForm(){
                const password = document.forms["myForm"]["password"].value;
                const confirmPassword = document.forms["myForm"]["confirmPassword"].value;
                if (password != confirmPassword) {
                    return alert("Las contraseñas no coinciden.");
                }
                //values of the form to json
                const form = document.getElementById('myForm');
                const data = new FormData(form);
                const value = Object.fromEntries(data.entries());
                if(value.avatar == ""){
                    value.avatar = 'https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png';
                }
                return sendForm(value);
            }

            const sendForm = async(form) => {
                const response = await fetch('/api/user/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(form)
                });
                if(await response.status == 201){
                    return window.location.href = '/login';
                }else{
                    return alert("Error al crear la cuenta.");
                }
            }
        </script>
    </body>
</html>